{{ $_hugo_config := `{ "version": 1 }` }}
{{ with .Page.Params.score_card }}

<div class="container-fluid mt-5 p-0" id="score-card-container">
  <div class="shadow form-mobile-desktop-layout bg-white rounded-blue-border">

    <!-- Title and icon -->
    <h3 class="">
      <span class="far fa-flag icon mb-4 pl-5 remove-on-pdf"></span>
      {{.title}}
    </h3>

    <div class="row mt-4">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <p>{{ .content | markdownify }}</p>
      </div>
    </div>

    {{ range .section }}
      <div class="mb-4">
        <h4>{{.title}}</h4>
      </div>

      {{ range .questions }}
        <h5>{{ .title }}</h5>
        <p>
          {{ .content | markdownify }}
          {{ if .tooltip }}
          <button class="remove-on-pdf" data-toggle="tooltip" data-placement="right"
            title={{.tooltip}}>
            {{ i18n "score-card--more-information" }}
          </button>
          {{ end }}
        </p>

        <div class="row mb-4">
          {{ $input_name := .identifier }}
          {{ range .options }}
            <div class="col-md col-sm-12">
              <label>
                <input type="radio" name={{$input_name}} class="card-input-element" value={{.value}} />
                <div class="card card-input">
                  <div class="card-body">
                    <h6 class="card-title">{{.title}}</h6>
                    <p class="card-text">
                      {{.content | markdownify}}
                    </p>
                  </div>
                </div>
              </label>
            </div>
          {{ end }}

        </div>
      {{ end}}
    {{ end }}
    <div class="shadow bg-lightblue py-4">
      <div class="row mx-3">
        <div class="col">
          <h4>
            {{ i18n "score-card--adjust" }}</h4>
        </div>
      </div>
      <div class="row mx-3 mt-4 mb-2">
        <div class="col-xl col-sm-12">
          <p>
            {{ i18n "score-card--scoring" }}
          </p>
        </div>

        <div class="col-xl col-sm-12">
          <div class="row align-items-start">
            <div class="col-xl-4 col-sm-6">
              <p class="text-nowrap">
                {{i18n "score-card--low"}}
              </p>
            </div>
            <div class="col-xl-7 col-sm-6">
              <input id="score-card-points-low" type="number" class="form-control" value="0" disabled>
            </div>
          </div>
        </div>

        <div class="col-xl col-sm-12">
          <div class="row align-items-start">
            <div class="col-xl-4 col-sm-6">
              <p class="text-nowrap">
                {{i18n "score-card--medium"}}
              </p>
            </div>
            <div class="col-xl-7 col-sm-6">
              <input id="score-card-points-medium" type="number" class="form-control" value="5">
            </div>
          </div>
        </div>

        <div class="col-xl col-sm-12">
          <div class="row align-items-start">
            <div class="col-xl-4 col-sm-6">
              <p class="text-nowrap">
                {{i18n "score-card--high"}}
              </p>
            </div>
            <div class="col-xl-7 col-sm-6">
              <input id="score-card-points-high" type="number" class="form-control" value="10">
            </div>
          </div>
        </div>
      </div>

      <div class="row mx-3 mt-4 mb-2">
        <div class="col-xl col-sm-12">
          <p>
            {{i18n "score-card--boundary-conditions"}}
          </p>
        </div>

        <div class="col-xl col-sm-12">
          <div class="row align-items-start">
            <div class="col-xl-4 col-sm-6">
              <p class="text-nowrap">
                {{i18n "score-card--low"}}
              </p>
            </div>
            <div class="col-xl-7 col-sm-6">
              <input id="score-card-threshold-low" type="number" class="form-control" value="0" disabled>
            </div>
          </div>
        </div>

        <div class="col-xl col-sm-12">
          <div class="row align-items-start">
            <div class="col-xl-4 col-sm-6">
              <p class="text-nowrap">
                {{i18n "score-card--medium"}}
              </p>
            </div>
            <div class="col-xl-7 col-sm-6">
              <input id="score-card-threshold-medium" type="number" class="form-control" value="5">
            </div>
          </div>
        </div>

        <div class="col-xl col-sm-12">
          <div class="row align-items-start">
            <div class="col-xl-4 col-sm-6">
              <p class="text-nowrap">
                {{i18n "score-card--high"}}
              </p>
            </div>
            <div class="col-xl-7 col-sm-6">
              <input id="score-card-threshold-high" type="number" class="form-control" value="10">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-5">
      <div class="col-xl col-sm-12">
        <p>
        <div class="d-inline-block color-blue font-weight-bold">{{i18n "score-card--total-score"}}: </div>
        <div id="score-card-result-score" class="d-inline-block color-gray"></div>
        </p>
        <p>
        <div class="d-inline-block color-blue font-weight-bold">{{i18n "score-card--classification"}}: </div>
        <div id="score-card-result-risk" class="d-inline-block color-gray"></div>
        </p>
      </div>
      <div class="col-xl col-sm-12">
        <button id="score-card-print-button" class="btn btn-primary remove-on-pdf"><i class="fas fa-print"></i> {{i18n "score-card--download-result"}}</button>
      </div>
    </div>
  </div>
</div>

{{ end }}

<script>
  document.addEventListener("DOMContentLoaded", function (event) {
    var calculateScores = function () {
      var score = 0;
      var points = {
        low: parseInt($('#score-card-points-low').val()),
        medium: parseInt($('#score-card-points-medium').val()),
        high: parseInt($('#score-card-points-high').val())
      };
      var thresholds = {
        low: parseInt($('#score-card-threshold-low').val()),
        medium: parseInt($('#score-card-threshold-medium').val()),
        high: parseInt($('#score-card-threshold-high').val())
      };
      $('#score-card-container input[type=radio]:checked').each(function () {
        score += points[$(this).val()];
      });
      $('#score-card-result-score').text(score);
      $('#score-card-result-risk').text(score >= thresholds.high ? '{{i18n "score-card--high-risk"}}' : score >= thresholds.medium ? '{{i18n "score-card--medium-risk"}}' : '{{i18n "score-card--low-risk"}}');
    };
    $('#score-card-container input[type=radio]').change(calculateScores);
    $('#score-card-container input[type=number]').change(calculateScores);
    calculateScores();


    $('#score-card-print-button').click(function () {
      window.html2canvas = html2canvas;
      var element = document.getElementById("score-card-container");
      var pdf = new jspdf.jsPDF();
      pdf.html(element, {
        callback: function (doc) {
          doc.save();
        },
        margin: [5, 5, 5, 5],
        x: 32,
        y: 32,
        html2canvas: {
          scale: 0.15,
          ignoreElements: (element) => {
            if (element.className.indexOf('remove-on-pdf') > -1) {
              return true;
            }
            return false;
          }
        },

      });
    });
  });
</script>