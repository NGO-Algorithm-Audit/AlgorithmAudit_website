{{ "<!-- navigation -->" | safeHTML }}

<header class="navigation col-12 shadow-sm" id="header-navigation">
  <div class="container col-12" id="header-container">

    <!-- navbar -->
    <nav class="navbar navbar-expand-xl navbar-light">
      <div class="navbar-div">
        <a class="navbar-brand" href="{{ site.Home.RelPermalink }}">
          {{ with site.Params.logo}}
          <img width="{{site.Params.logo_width}}" class="img-fluid" src="{{ . | relURL }}" alt="{{ site.Title }}" style="min-width: {{site.Params.logo_width}};">
          {{ else }}{{site.Title}}{{end}}
        </a>
      </div>
      <div class="button-div">
        <button class="navbar-toggler collapsed border-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-label="menu">
          <i class="fas fa-bars navbar-toggler-menu" id="bars" style="color:#005aa7"></i>
          <i class="fas fa-times cross" style="color:#005aa7"></i>
        </button>
      </div>

      <!-- nav items -->
      <div class="collapse navbar-collapse text-center" id="navigation">
        <ul class="navbar-nav mx-auto">
          {{ range site.Menus.main }}
          {{ if .HasChildren }}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown">
              {{ .Name }}
            </a>
            <div class="dropdown-menu shadow-lg" style="padding: 1rem 0.25rem;">
              {{ range .Children }}
              {{if .Params.subtitle}}
              <p class="mb-0 mt-1 ml-3" style="color:#005aa7; font-weight:550; font-size:13px;">{{.Params.subtitle}}</p>
              {{end}}
              <a class="dropdown-item mr-4" href="{{ .URL | relURL }}" target="{{ .Params.target }}"  title="{{ .Name }}" style="padding: 0.75rem 1.5rem;color: #005aa7;">
                {{if .Params.icon}}
                <i class="fas {{.Params.icon}} col-2 pl-0"></i>
                {{end}}
                {{ if .Params.Featured }}
                <div class="mb-1 text-center rounded" style="padding: 0.5rem 0.5rem; background-color: #dfeaf4;">
                {{ end }}
                  {{.Pre}}{{ .Name }}{{.Post}}
                {{ if .Params.Featured }}
                <i class='fas fa-arrow-right ml-2'></i>
                </div>
                {{ end }}
              </a>
              {{ end }}
            </div>
          </li>
          {{ else }}
          <li class="nav-item">
            <a class="nav-link" href="{{ .URL | relURL }}" title="{{ .Name }}">{{ .Name }}</a>
          </li>
          {{ end }}
          {{ end }}

          <!-- Language toggle -->
           
          {{ if .IsTranslated }}
          {{ range .Translations }}
          <li class="nav-item d-inline-block" style="min-width: 137px;">
            <a href="{{ .RelPermalink }}" class="nav-link d-inline-block nowrap" title="Language toggle">
              <div class="d-inline" {{ if eq .Site.Language.Lang "en" }} style="font-weight: 350;" {{ end}}>
                EN
              </div>
              <!-- Rounded switch -->
              <label class="switch d-inline-block mx-1">
                <input type="checkbox" disabled aria-checked={{if eq .Site.Language.Lang "en" }} "true" checked {{else}} "false" {{ end }} id="lang-toggle" role="switch">
                <span class="slider round"></span>
              </label>
              <div class="d-inline" {{ if eq .Site.Language.Lang "nl" }} style="font-weight: 350;" {{ end}}>
                NL
              </div>
            </a>
          </li>
          {{ end }}
          {{ end }}
          <!-- /Language toggle -->

          <style>
            .elbi-results {
                width: 100%;
            }
            .elbi-results-item {
                background-color: #FFFFFF;
                color: #000000;
                padding: 10px;
                border: 1px solid black;
            }
        </style>
        
        <div>
            <input type="search" class="input is-size-4" id="elbi-input" placeholder="Search the site...">
            <ul id="elbi-results"></ul>
        </div>
        
        <script>
            const input = document.getElementById("elbi-input");
            const results = document.getElementById("elbi-results");
            const request = new Request("/index.json");
            const display_score = false; // Set to true if you want to see the score in the results
        
            fetch(request)
                .then(response => response.json())
                .then(data => {
                    let pages = data;
        
                    input.addEventListener("input",function(){
                        let filteredPages = pages;
                        results.innerHTML = "";
        
                        // If there is something in the search field
                        if (input.value != ""){
        
                            // Reset the page score to zero
                            filteredPages.forEach(function(page) {
                                page.score = 0;
                            });
        
                            // Create array of search terms, split by space character
                            // Normalize and replace diacritics
                            let searchterms = input.value.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().split(" ");
        
                            // Apply a filter to the array of pages for each search term
                            searchterms.forEach(function(term) {
                                if (term != "") {
                                    filteredPages = filteredPages.filter(function(page) {
                                        // The description is the full object, includes title, tags, categories, and summary text
                                        // You could make this more specific by doing something like:
                                        // let description = page.title;
                                        // or you could combine fields, for example page title and tags:
                                        // let description = page.title + ' ' + JSON.stringify(page.tags)
                                        let description = JSON.stringify(page);
                                        return description.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().indexOf(term) !== -1;
                                    });
                                }
                            }); // end of filter for loop
        
                            // Apply weighting to the results
                            searchterms.forEach(function(term) {
                                if (term != "") {
                                    // Loop through each page in the array
                                    filteredPages.forEach(function(page) {
        
                                        // Assign 3 points for search term in title
                                        if (page.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                            page.score += 3
                                        };
        
                                        // Assign 2 points for search term in tags
                                        if (JSON.stringify(page.tags).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                            page.score += 2
                                        };
        
                                        // Assign 1 point for search term in summary
                                        if (page.summary.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                            page.score += 1
                                        };
        
                                        // Assign 1 point for search term in the page categories
                                        if (JSON.stringify(page.categories).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                            page.score += 1
                                        };
                                    })
                                };                                      
                            });
        
                            // Filter out any pages that don't have a score of at least 1
                            filteredPages = filteredPages.filter(function(page){
                                return page.score > 0;
                            })
        
                            // sort filtered results by title
                            // borrowed from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort
                            filteredPages.sort(function(a, b) {
                                const titleA = a.title.toUpperCase(); // ignore upper and lowercase
                                const titleB = b.title.toUpperCase(); // ignore upper and lowercase
                                if (titleA < titleB) {
                                    return -1;
                                }
                                if (titleA > titleB) {
                                    return 1;
                                }
                                // titles must be equal
                                return 0;
                            });
                            
                            // then sort by page score
                            filteredPages.sort(function(a, b) {
                                return b.score - a.score;
                            });
        
                            // For each of the pages in the final filtered list, insert into the results list
                            filteredPages.forEach(function(page) {
                                
                                results.insertAdjacentHTML("beforeend",
"<li class='elbi-results-item'>" + "<h2 style='font-size: 1.5rem;'><a href='" + page.permalink + "'>" + page.title + "</a></h2><p>" + page.summary + "</p><p style='margin-top: 5px'>Tagged: <strong>" + page.tags + "</strong></p></li>");
        
                                if (display_score == true) {
                                    results.insertAdjacentHTML("beforeend","<p>Result score: " + page.score + "</p>")
                                };
        
                            }); // end of page for loop
        
                        }; // end of IF
                        
                    }); // end of event listener
                });
        </script>
        </ul>
      </div>
      <!-- /nav items -->

    </nav>
    <!-- /navbar -->

  </div>

</header>

{{ "<!-- /navigation -->" | safeHTML }}